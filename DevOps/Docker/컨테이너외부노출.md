# 컨테이너 외부 노출

## 컨테이너 ip 확인해보기

우분투 컨테이너를 생성하고 접속 해본 다음 `ifconfig` 명령을 통해 ip가 어떻게 되어있는지 확인해보자.
  
그냥 하면 ifconfig라는 명령을 찾을 수 없다고 나오는데 이는 아무것도 설치되지 않은 상태라 그렇다.

```
$ apt-get update
$ apt-get install net-tools
```

net-tools를 설치하고 ifconfig를 해보면 잘 실행되어진다.

![](https://velog.velcdn.com/images%2Fckstn0777%2Fpost%2F73aab8e4-35d7-4782-8afd-e2c33a571901%2Fimage.png)

도커는 컨테이너에 `172.17.0.X`의 IP를 순차적으로 할당해준다. 참고로 밑에 Io는 로컬 호스트를 의미한다.

<br>

## 컨테이너 포트포워딩
외부에 컨테이너의 애플리케이션을 노출하기 위해서는 eth0의 IP와 포트를 호스트의 IP와 포트에 바인딩해야한다.
  
이미 생성한 컨테이너가 있으면 삭제하고 다시 설정해야 한다.

```
$ docker run -it --name mywebserver -p 80:80 ubuntu:18.04
```

위 명령을 실행한 다음, 컨테이너 내부로 들어와서 아파치 웹 서버를 설치해주자. 참고로 아파치 웹 서버는 80번 포트에서 동작한다. 도커 컨테이너 80번을 열어둔 것은 이러한 이유이기 때문이다.

```
$ apt-get update
$ apt-get install apache2
$ service apache2 start
```

`docker ps -a` 명령을 통해 포트 설정이 제대로 되었는지 확인할 수 있다.

![](https://velog.velcdn.com/images%2Fckstn0777%2Fpost%2F8180ce5e-4f74-4df0-9e35-2db278da9bc0%2Fimage.png)

AWS 보안 그룹에 가서 80번 포트가 열렸는지 확인해보고 퍼블릭 ip로 접속해보자

![](https://velog.velcdn.com/images%2Fckstn0777%2Fpost%2F83709e3f-23df-4190-867b-7d6d2c72e14b%2Fimage.png)

## 구조 이해하기

포트포워딩을 이해하지 못한다면 이게 어떻게 연결되는지 의아할 수도 있다.
  
흔히 ip는 퍼블릭 아이피와 사설 아이피로 나눠서 구분된다.
  
공유기를 쓰고 있다면 공유기에 접속하는 거는 퍼블릭 아이피이고 공유기가 나눠주는 것은 사설 아이피이다.
  
그리고, 사설 아이피를 쓰고 있는 컴퓨터에서  포트를 열어주더라도 외부에서는 접근할 수 없다.
  
그래서 퍼블릭아이피:포트번호와 사설아이피:포트번호를 서로 연결해주는 작업을 하게되는데 이를 **포트 포워딩**이라고 한다.
  
도커 컨테이너도 마찬가지이다. AWS 보안 그룹에서 80번을 열어두더라도 도커 컨테이너가 호스트와 포워딩이 되어있지 않으면 접근할 수 없다. 접근이 가능하게 하려면 위와 같은 작업을 해주어야한다.